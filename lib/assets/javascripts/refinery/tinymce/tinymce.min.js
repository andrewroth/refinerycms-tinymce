(function(window, $){'use strict';(function(f){var g;f.Object.create({name:"Tinymce",module:"tinymce",k:function(a){"undefined"===typeof g&&(g=$.Deferred(),$.getScript(a,function(){tinymce&&(tinymce.baseURL=a.replace(/[^\/]+$/,""),tinymce.dom.Event.domLoaded=!0,tinymce.PluginManager.add("refinery_links",function(a){a.addButton("link",{text:t("refinery.tinymce.link"),icon:!1,onclick:function(){a.refinery_links_dialog.init().open()}})}),tinymce.PluginManager.add("refinery_images",function(a){a.addButton("image",{text:t("refinery.tinymce.image"),
icon:!1,onclick:function(){a.refinery_images_dialog.init().open()}})}),g.resolve())}));return g.promise()},g:function(a,b){b.on("insert",function(e){var d=a.selection.getContent(),c=$("<a/>",{href:e.url});e.blank&&c.attr("target","_blank");""===d?c.text(e.title):c.html(d);a.selection.setNode(c.get(0));b.close()});a.refinery_links_dialog=b},f:function(a,b){var e=this;b.on("insert",function(d){var c='<img src="%url" alt="%alt" />';d.url?(c=c.replace("%alt",f.htmlEncode(d.alt)),c=c.replace("%url",d.url),
a.insertContent(c)):e.l(a,d.id,b);b.close()});a.refinery_images_dialog=b},l:function(a,b,e){var d,c;c=[{text:t("refinery.tinymce.insert"),"class":"submit-button",click:function(){d.insert(d.holder)}},{text:t("refinery.tinymce.back_to_library"),click:function(){d.destroy();e.open()}}];d=this.i(b,c);d.on("insert",function(b){var c;c='<img src="%url" alt="%alt" />'.replace("%alt",f.htmlEncode(b.alt));c=c.replace("%url",b.sizes[b.size]);a.insertContent(c);d.destroy()});this.on("destroy",function(){d.destroy()});
d.init().open()},insert:function(a){this.h.insertContent(a)},e:function(){this.a();this.holder.removeClass("wysiwyg-editor-on");this.holder.find(".mce-tinymce").hide();this.holder.find("textarea").show()},a:function(){try{tinymce.triggerSave()}catch(a){f.log(a)}},destroy:function(){this.is("initialised")&&(this.e(),this.d.remove(),tinymce.remove(),this.b.destroy(),this.c.destroy(),this.holder.closest("form").off("before-submit",this.a));this._destroy();return this},j:function(){var a=this,b=a.holder,
e=b.find("textarea"),d=b.data("editor-options")||{};d.convert_urls=!1;d.selector=d.selector||"#"+e.attr("id");d.setup=function(c){a.f(c,a.b);a.g(c,a.c);c.on("init",function(){b.addClass("wysiwyg-editor-on");a.h=c;a.is({initialised:!0,initialising:!1});a.trigger("init")})};a.d=$("<button/>",{"class":"wysiwyg-toggle-button",text:t("refinery.admin.toggle_editor")}).appendTo(b);a.d.on("click",function(c){c.preventDefault();b.hasClass("wysiwyg-editor-on")?a.e():(b.addClass("wysiwyg-editor-on"),b.find(".mce-tinymce").show(),
b.find("textarea").hide(),$(b.find(".mce-edit-area iframe").get(0).contentWindow.document.body).html(e.val()))});b.closest("form").on("before-submit",a.a);a.k(d.tinymce_url).done(function(){tinymce.init(d)})},init:function(a,b){this.is("initialisable")&&(this.is("initialising",!0),this.holder=a,this.b=b[0],this.c=b[1],this.i=b[2],this.j());return this}});f.admin.ui.editorTinymce=function(a,b){function e(a,b){return f("admin.ImageDialog",{image_id:a,buttons:b})}a.find(".wysiwyg-editor-wrapper").each(function(){b.addObject(f("tinymce.Tinymce").init($(this),
[f("admin.ImagesDialog"),f("admin.LinksDialog"),e]))})}})(refinery);}(window, jQuery));
