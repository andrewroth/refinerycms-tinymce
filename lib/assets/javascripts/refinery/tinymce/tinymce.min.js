(function(window, $){'use strict';(function(f){var g;f.Object.create({name:"Tinymce",module:"tinymce",k:function(b){"undefined"===typeof g&&(g=$.Deferred(),$.getScript(b,function(){tinymce&&(tinymce.baseURL=b.replace(/[^\/]+$/,""),tinymce.dom.Event.domLoaded=!0,tinymce.PluginManager.add("refinery_links",function(a){a.addButton("link",{text:t("refinery.tinymce.link"),icon:!1,onclick:function(){a.refinery_links_dialog.init().open()}})}),tinymce.PluginManager.add("refinery_images",function(a){a.addButton("image",{text:t("refinery.tinymce.image"),
icon:!1,onclick:function(){a.refinery_images_dialog.init().open()}})}),g.resolve())}));return g.promise()},g:function(b,a){a.on("insert",function(e){var d=b.selection.getContent(),c=$("<a/>",{href:e.url});e.blank&&c.attr("target","_blank");""===d?c.text(e.title):c.html(d);b.selection.setNode(c.get(0));a.close()});b.refinery_links_dialog=a},f:function(b,a){var e=this;a.on("insert",function(d){var c='<img src="%url" alt="%alt" />';d.url?(c=c.replace("%alt",f.htmlEncode(d.alt)),c=c.replace("%url",d.url),
b.insertContent(c)):e.l(b,d.id,a);a.close()});b.refinery_images_dialog=a},l:function(b,a,e){var d,c;c=[{text:t("refinery.tinymce.insert"),"class":"submit-button",click:function(){d.insert(d.holder)}},{text:t("refinery.tinymce.back_to_library"),click:function(){d.destroy();e.open()}}];d=this.i(a,c);d.on("insert",function(a){var c;c='<img src="%url" alt="%alt" />'.replace("%alt",f.htmlEncode(a.alt));c=c.replace("%url",a.sizes[a.size]);b.insertContent(c);d.destroy()});this.on("destroy",function(){d.destroy()});
d.init().open()},insert:function(b){this.h.insertContent(b)},e:function(){this.a();this.holder.removeClass("wysiwyg-editor-on");this.holder.find(".mce-tinymce").hide();this.holder.find("textarea").show();this.b.destroy();this.c.destroy()},a:function(){tinymce.triggerSave()},destroy:function(){this.is("initialised")&&(this.e(),this.d.remove(),tinymce.remove(),this.holder.closest("form").off("before-submit",this.a));this._destroy();return this},j:function(){var b=this,a=b.holder,e=a.find("textarea"),
d=a.data("editor-options")||{};d.convert_urls=!1;d.selector=d.selector||"#"+e.attr("id");d.setup=function(c){b.f(c,b.b);b.g(c,b.c);c.on("init",function(){a.addClass("wysiwyg-editor-on");b.h=c;b.is({initialised:!0,initialising:!1});b.trigger("init")})};b.d=$("<button/>",{"class":"wysiwyg-toggle-button",text:t("refinery.admin.toggle_editor")}).appendTo(a);b.d.on("click",function(c){c.preventDefault();a.hasClass("wysiwyg-editor-on")?b.e():(a.addClass("wysiwyg-editor-on"),a.find(".mce-tinymce").show(),
a.find("textarea").hide(),$(a.find(".mce-edit-area iframe").get(0).contentWindow.document.body).html(e.val()))});a.closest("form").on("before-submit",b.a);b.k(d.tinymce_url).done(function(){tinymce.init(d)})},init:function(b,a){this.is("initialisable")&&(this.is("initialising",!0),this.holder=b,this.b=a[0],this.c=a[1],this.i=a[2],this.j());return this}});f.admin.ui.editorTinymce=function(b,a){function e(a,b){return f("admin.ImageDialog",{image_id:a,buttons:b})}b.find(".wysiwyg-editor-wrapper").each(function(){a.addObject(f("tinymce.Tinymce").init($(this),
[f("admin.ImagesDialog"),f("admin.LinksDialog"),e]))})}})(refinery);}(window, jQuery));
